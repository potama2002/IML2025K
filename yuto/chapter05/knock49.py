import google.generativeai as genai
import os
from dotenv import load_dotenv

# 環境変数からAPIキーを読み込む
load_dotenv()
api_key = os.getenv("GOOGLE_API_KEY")

# APIキーを設定
genai.configure(api_key=api_key)

# 計測対象のテキスト
text = """
吾輩は猫である。名前はまだ無い。

どこで生れたかとんと見当がつかぬ。何でも薄暗いじめじめした所でニャーニャー泣いていた事だけは記憶している。吾輩はここで始めて人間というものを見た。しかもあとで聞くとそれは書生という人間中で一番獰悪な種族であったそうだ。この書生というのは時々我々を捕えて煮て食うという話である。しかしその当時は何という考もなかったから別段恐しいとも思わなかった。ただ彼の掌に載せられてスーと持ち上げられた時何だかフワフワした感じがあったばかりである。掌の上で少し落ちついて書生の顔を見たのがいわゆる人間というものの見始であろう。この時妙なものだと思った感じが今でも残っている。第一毛をもって装飾されべきはずの顔がつるつるしてまるで薬缶だ。その後猫にもだいぶ逢ったがこんな片輪には一度も出会わした事がない。のみならず顔の真中があまりに突起している。そうしてその穴の中から時々ぷうぷうと煙を吹く。どうも咽せぽくて実に弱った。これが人間の飲む煙草というものである事はようやくこの頃知った。
"""

# トークン数を計測するプロンプト
prompt = f"""
あなたは世界最強のトークン数え者です
以下のテキストのトークン数を計測してください。
トークン数とは、テキストを処理する際の最小単位です。
日本語の場合、文字、句読点、空白などがトークンとしてカウントされます。
あなたの世界最強という名に恥じぬように精度高くカウントして下さい

テキスト:
{text}

トークン数を数えて、その結果を出力してください。
また、トークンの内訳（文字、句読点、空白など）も可能であれば示してください。
"""

# モデルの設定
model = genai.GenerativeModel("gemini-1.5-flash-8b")

# トークン数を計測
response = model.generate_content(prompt)

# 結果の表示
print("トークン数計測結果:")
print(response.text)

# Geminiのトークンカウント機能を使用
print("\nGeminiのトークンカウント機能を使用:")
# トークン数を計測
token_count = model.count_tokens(text)
print(f"トークン数: {token_count}")

"""トークン数計測結果:
トークン数計測結果:
トークン数：188

内訳：

* 文字：176
* 句読点：11
* 空白：1

詳細な内訳は、トークンを正確に区別するのが困難な場合もあります。
例えば、句読点の一部は、空白によって区切られる場合と、そうでない場合があるからです。 今回のカウントは、最良の推定に基づいています。


Geminiのトークンカウント機能を使用:
トークン数: total_tokens: 252

"""